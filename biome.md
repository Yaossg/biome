# 再析世界生成：生物群系

![](icon.png)

## 序

### 前作

> 我也不清楚这里我说了什么，你们清楚吗？
>
> ——Yaossg《浅析1.13世界生成》选定生物群系

你好像没见过上面这句话？你现在去看看，你看到这篇文章的时候，上面这句话已经被加到前作讲生物群系生成的那一节了。

写前作我我完全是一时兴起——我当时毫无这方面的经验。我一直以来对世界生成有着敬畏之心，因为世界生成总是给人一种宏大、复杂、难以研究的感觉。我试过寻找一些世界生成的文章，Switefaster 给我推荐了土球的那一篇。但都是盲人摸象，浅尝辄止。

----

1.13 原本是技术更新，代码大重写。在此之前我也开发过 1.12 Forge 的模组，对于 1.13 的代码可以说是耳目一新。这样的代码是 Mojang 写出来的？对我来说在以前想都不敢想。1.13 Forge 刚出的时候，正好是寒假，我马不停蹄开始了创作，那几天几乎是不分昼夜，终于在令我自己都难以相信的短时间内完成了文章。

为什么是「浅析」呢，因为我几乎是囫囵吞枣地把每个环节都过了一遍，造成差点把我噎死——我的理解不尽完善，文章漏洞百出，在这里再次感谢提出指正意见的读者。也有反馈说感觉内容不够详细，我想大概也是事实，但这也是不可避免的。

### 续作

> 一切都要从一只蝙蝠说起
>
> ——网络

在家的我又重新研究起了世界生成。

这次本来没想写这篇文章的——我最初的想法并不复杂，就是看看：原版如何生成生物群系？在这之前，其实已经有了不少模拟世界生成的网站、软件，或无扩展性可言，或依赖于 minecraft.jar。于是我萌生了做一个独立的生物群系生成模拟 api。把原版生物群系生成逻辑剥离出来，我相当于就研究了这整个过程，既然都研究了，索性就记录了下来。

我在写这篇文章的过程中，正经历着 1.16 下界更新，下界不再单调，最后一个单生物群系的维度跟我们说再见了。好在 1.14 - 1.16 的主世界生成代码都是一样的，我的前期努力没有白费。在不断探索的过程之中，我更进一步的加入了许多相关的内容，也许最初文章的目标仅仅只是主世界的生物群系，但一不做二不休，既然来都来了，那我就干脆莽到底！

这次的创作还包含了前所未有的大胆尝试，想要带给大家的不再仅仅是干巴巴的文字：因为可视化是展示世界之美的重要一环。前作可是一幅图都没有；这次不仅又图，我还准备了视频以供欣赏。

----

> 「长期更新」和「长期不更新」其实是一个意思，「长期」这个词本身就有了这个含义。
>
> ——Yaossg，一次关于「长期更新」的讨论中

[...]

## 凡例

> 我再说一遍，（mcp、yarn中的）这些名字都是社区提供的
>
> ——3TUSK

[TODO]

##  生物群系与世界生成

> 如果你不知道什么叫作“生物群系”，我可以告诉你，它是游戏中用于设置何种地表（沙子？还是草？），是下雨还是下雪，长什么树，以及允许何种动物生成的气候区。
>
> ——Jens "Jeb" Bergensten

提到世界生成，你们最先想到的是什么？我想没有什么比新的**生物群系（Biome）**更加令人侧目了。因为一个全新的生物群系意味着一个完整的系统：**温度**、**降水量**、植被（比如**花**）、**生物**、地形（**深度**和**规模**）、地貌（**镂空器**）、特性、各种**视觉效果**等等。

是的，这个世界无处没有生物群系，这个世界就是由生物群系组成，这个世界的万物包含在生物群系之中。而在代码层面，生物群系的世界生成的影响也十分深远。其中一个重要的体现就在于：

### 生物群系——生成区块的第一步

> Minecraft会首先获取当前区块下所有的生物群系。
>
> ——ustc-zzzz《答知乎提问：Minecraft 的地形生成算法是什么？》

>在 1.13 以后，不再这样笼统的区分，每个区块都拥有一个状态，每个状态都表示他**已经完成**的某一个任务，并提供下一个任务，以此实现**异步**的区块生成。
>
>_（第一个状态）_基础（base）状态的第一步：生物群系将会被选定
>
>——Yaossg《浅析1.13世界生成》

无论是 1.13 之前还是之后，**生成生物群系都是生成区块的的第一个步骤**。这一关键的步骤在历史上发生了许多重大的变迁。下面我们一起走进历史，领略一下过往的经验与教训。

## 生物群系的历史回顾
这一部分资料部分整理自 Minecraft 官方维基百科

### Alpha 1.2

生物群系正式加入，主世界有 10 种，下界 1 种，2 种未使用。在这个版本中，**温度**和**降水量**的概念已经有所体现。生物群系的布局根据温度和降水量有关，因此不会出现突兀的温度变化。但是也由于温度和降水量基于噪声算法，导致你会看到犬牙交错的边界，而非平滑的过渡，因此可以认为边缘**宏观平滑，微观破碎**。同时由于这个版本的生物群系生成的普遍较小，导致破碎的根绝更为明显。丘陵、断崖、海洋、沙滩并非作为生物群系出现，而是用算法在生成好的生物群系上进行的二次创作。

我相信这样的破碎可能不会适用于拥有大好风光的主世界，但是如果是一个本来就混沌、荒芜的世界呢？谁能想到，多年之后，这样的生成方式经过一些改进，被用于下界的生物群系生成？


### Beta 1.8 - 1.1

生物群系重写。采用了基于分形（Fractal）的算法，这实际上奠定了长期以来世界生成的方法，**一直沿用至今**。后文会详细介绍这样的生成方式。生物群系变得更大，海洋变得更广更深。河流会在生物群系里或者生物群系之间流动并注入海里。河流、丘陵、山地、海洋、沙滩也先后成为生物群系。除了原有的山地（Mountains），还加入了各色的丘陵（Hills），积雪的生物群系又被重新加入。相邻生物群系的温度降雨量的渐变不再体现，常有河流间隔。此外水和植被的颜色有了平滑的过渡。因此可以认为边缘**宏观破碎，微观平滑**。

### 1.2

采用了全新的世界格式 **Anvil**。 与过去不同的是，生物群系信息不再动态计算，而是被储存在了区块文件中：世界一旦生成，这一数值就不会发生改变。这种做法的提高了游戏运行效率，当然这也给外部修改提供了可能。有关世界生存的储存问题，后面还会提到。

加入了丛林，预留给树木的四个数据值占满了，大家都以为树木“齐了”，以后还会有更多树吗？

### 1.7

~~迪斯科山！~~<sub>Jeb语</sub> 平顶山的奇丽景色可能让人第一时间让人关注到这次更新上来。

此次更新加入的生物群系比以前所有版本加入的生物群系加起来还要多，引入了大量的**变种（Mutation）**生物群系。变种是多样化生物群系的好手段。比如在 1.6 时移除的沙漠湖泊，被作为沙漠的一个变种——一种带湖泊的沙漠重新加入。

相邻的生物群系会尽可能的避免突变（从最热到最冷，从最干到最湿），宏观上平滑度有所增加。但也只是尽可能的，所以也比较有限。

移除了过多的海洋、加入了深海。更新前的几乎无尽的海洋不复存在，世界超过半数面积变为了陆地，为新加入的生物群系提供了空间。而深海的加入使海洋的层次更为分明。更新前，玩家分明是生活在一座座被无限大海洋的包围的巨型岛屿上的；更新后，反而成了海洋破碎分布在大陆之间。

重磅回归的热带草原上长着新加入游戏的树木。新树木，Mojang 开了几个新的类，分配了几个新的 id。新沙石，方块好说，台阶却满了，于是又给红砂石台阶分配了新的 id。而在开发平顶山的时候，Mojang 发现之前地表构造器的完全无法复用，索性写了一个完全不同于其他所有生物群系的。

[附录](#1.7 生物群系和 ID)里收录了我还原的当年维基百科上挂过的一张表。方便起见，名称使用的是 1.16 的 Biome namespaced id。当时这样的安排可以认为是故意的——显然在 Mojang 看来，获取某个生物群系的变种只不过是 +128 那么简单罢了。新生物群系的命名也极度诡异，诸如M、F、+此类莫名其妙的记号，后来到了扁平化的时候背悉数消灭（但到了最后还是留下了一个+），就连标志性的平顶山也被重命名为“恶地”<sub>，让很多人误以为是机翻</sub>。

从我前面的描述，你可以感受到的是一副宏伟的画卷在逐步展开，可当你驻足观望，不难发现一片盛景之下潜伏的是无处不在的种种危机。扁平化呼之欲出，重写的腥风血雨正在降临。

### 1.13

> 1.13 Mojang 做出的努力使我眼前一亮，世界生成可以说是最重要的一部分，Mojang 迈出了第一步，希望这不是最后一步。
>
> ——Yaossg《浅析1.13世界生成》

![](3T's sigh.png)

**扁平化（The Flattening）**，世界生成重写。详见前作[《浅析1.13世界生成》](../tutorial.md)

末地的生物生物群系不再全是 ~~sky~~ <sub>扁平化后：</sub>the_end，在末地外岛，不同的地形对应了不同的生物群系，这也就贯彻了生物群系的设计初衷。与主世界的层层叠加不同，末地生物群系的生成比较简单。后面会详细介绍。

水域更新让海洋拥有了温度，根据噪声算法来决定。温度不同——生物群系不同，这贯彻了生物群系的设计初衷。

> 这次Mojang代码的重构采用了全新的设计模式，增加了代码的可扩展性，主要体现在：
> - 将世界生成的功能被集中在了区块生成器和**生物群系**两部分上面，而不是离散在方方面面，更便于对代码之间的关系进行分析。
>
> ——Yaossg《浅析1.13世界生成》

生物群系把握了世界生成的大量内容。毫无疑问，五彩斑斓的世界正是生物群系所赐。后面我会详细介绍生物群系的一些属性。

### 1.14

重写了主世界的生成系统，最终不再是三个层，而是一个。后面还会详细介绍。

### 1.15

> 当然，_（主世界）_生物群系和高度无关。
>
> ——ustc-zzzz《答知乎提问：Minecraft 的地形生成算法是什么？》

加入了生物群系的在 y 轴上的支持，并在末地和下界更新中被使用。当然了，主世界依然与高度**无关**。采用了局部动态计算降低缓存量。后面还会提到。

### 1.16

> 我相信这样的破碎可能不会适用于拥有大好风光的主世界，但是如果是一个本来就混沌、荒芜的世界呢？谁能想到，多年之后，这样的生成方式经过一些改进，被用于下界的生物群系生成？
>
> ——Yaossg《再析世界生成：生物群系》生物群系的历史回顾：Alpha 1.2

下界更新！引入了气候参数，用来生成下界的生物群系。等会……这方法，好像在 Alpha 1.2 见过？

## 生物群系属性

**温度（Temperature）**、**降水量（Rainfall）**、**深度（Depth）**、**规模（Scale）**、**类别（Category）**、**降水类型（RainType）**和**变种（Mutation）**是生物群系的基本属性。详细数据见[附录](#生物群系属性表)。

### 温度、降水量、降水类型和天气

#### 温度

**温度**这一属性代表了这个生物群系的默认温度。具体到每个方块上的不妨叫**当地温度**，会根据噪声算法动态和高度地计算，冻洋和封冻深海有特殊的计算方式。高度占主导因素：在 y > 64 后，温度会逐渐减小。

#### 降水量和降水类型

**降水量**代表了这个生物群系的具体湿度。主要用于决定草的颜色，此外降水量大于 0.85 的生物群系的对火的蔓延有抑制作用。而与降水量定量不同，**降水类型**更多的是定性。

以上属性造成影响如下表所示：

|   当地温度   | 降水类型 |           影响           |
| :----------: | :------: | :----------------------: |
|      -       |   snow   |        雪地兔兔~         |
| 大于等于0.15 |   rain   |        判定为下雨        |
| 大于等于0.15 |    -     |    不会有雪、不会有冰    |
|   小于0.8    |    -     | 雪人走过的地方会产生雪片 |
|    大于1     |    -     |         雪人受伤         |

此外，温度和降水量还会参与到植物颜色的渲染。

### 深度、规模和地形

**深度**描述的是生物群系的平均海拔。注意这是一个平均值，比如若该数值为 0，虽说理论上是和海平面齐平，但其实相当低洼，因为真正的高度会根据噪声和规模有所起伏。

**规模**描述的是生物群系的高度差值。这个数值越大，地形的高低起伏越大。**放大化（Amplified）**世界类型、**自定义**世界类型的“山脉狂魔”预设就是扩大了这个数值。

### 类别

类别描述的是某一类生物群系所拥有的共同特征。例如，当我说“恶地”的时候，浮现在你脑海里的，绝对不止一个生物群系；那具体有几个恶地、分别叫什么呢？可能就会难倒不少人了。但有一点毫无疑问：反正它跟恶地是一类嘛，这也就是类别的意义。

类别在许多领域都有应用，这里没法一一举例了。而它在生物群系生成中扮演的重要的角色，将在后面介绍的[相似生物群系](#相似生物群系)中大显光彩。

### 失落的属性：温度类别

**温度类别**也是世界生成时用到的属性之一，而且仅在世界生成中使用。它是根据类别、温度这两个属性计算出来的。分为海洋、冷、中和暖。

然而不幸的是，唯一使用它的地方不是别处，正是决定是否生成山地边缘的代码。结果你也知道了，经过化简得出：山地边缘一定不会生成。是具体是什么原因导致了山地边缘的消失呢？后文会给出答案。

### 视觉效果

**天空颜色**，根据温度算出。

**生物群系特效**，1.16 引入的新鲜玩意，以前是分开的属性。分别是**雾的颜色**、**水的颜色**、**水中雾的颜色**，还有可选的**粒子效果**——下界里你眼前导出飞的火星子就是它造成的。

### 气候参数

**气候参数（ClimateParmater）**[TODO: 介绍、表、后面对应的内容]



### 其他世界生成属性

**地表构造器（SurfaceBuilder）、镂空器（Carver）、生物生成（Spawn）、特性（Feature**，包括普通特性、**花、结构（Structure））**。

## 生成生物群系的基础

### 区域

**区域（Area）**是 MC 生成生物群系的最小单位。大小为 4 x 4 x 4 **方块**。

**注意：Region（32 x 32 区块）的翻译也是“区域”。本文无特别说明区域均指 Area，请勿混淆。**

在 1.15 之前，每个区块的生物群系被储存在一个大小为 16 x 16 的数组里面，储存了区块内每一个 1 x 1 x 256 的生物群系。

1.15 更新之后，每个区块的生物群系被储存在一个大小为 4 x 4 x 64 的数组里面，数组里的每一个元素，代表的是一个区域里的生物群系，至于每个方块的生物群系，会动态地计算。

尽管加入了高度支持，但目前所有的生物群系生成得到的 x 和 z 相同而 y 不同的区域仍然总是包含相同的生物群系；真正高度上的差别是体现在最后打磨后的，方块尺度上的。因此除非特殊说明，本文用`x, z`这样的二元组来表示 x 和 z 相同的 16 个区域（坐标），而非方块坐标。

### 生物群系来源

**生物群系来源（BiomeSource）**是区域生物群系的提供者。它的功能其实有很多，但是在本教程里面只涉及他提供生物群系这一个功能，可以被描述为一个函数：

`BiomeSource: (x, z) -> Biome`

要得到这样一个函数，需要**生物群系来源类型（BiomeSourceType）**和对应的**生物群系来源配置（BiomeSourceConfig）**后者是通过解析存档的 NBT 文件得到的，而前者和 NBT 文件都是在创建世界时决定的。配置的作用是用于储存一些额外的生成参数，而类型是描述大体的类型差异，这种设计模式在前作我也提到过。下表列出的是 1.16 所有的生物群系来源类型。

| id              | 中文     | 配置所需         | 介绍                         |
| --------------- | -------- | ---------------- | ---------------------------- |
| checkerboard    | 棋盘     | 生物群系池、规模 | 生物群系呈现棋盘状分布       |
| fixed           | 固定     | 单个生物群系     | 全世界生物群系相同           |
| vanilla_layered | 原版层   | 种子、世界类型   | 用于原版主世界的生物群系生成 |
| the_end         | 末地     | 种子             | 用于末地的生物群系生成       |
| multi_noise     | 多重噪声 | 种子             | 用于下界的生物群系生成       |

[TODO： 1.16 Customize]

接下来详细讲解每一个生物群系来源生成生物群系的过程。

## 主世界层详解

![](SF's Question.png)

> 注意，生物群系并非按区块生成的哦！

**主世界（Overworld）**是玩家出生、长期生存的维度，也是生物群系资源最为丰富的维度。相信很多人都有和 Sebrarin 一样的疑惑：主世界的生物群系究竟是怎么生成的呢？

### 层

> 对于_（主世界）_生物群系的获取，Minecraft代码是使用一种类似于Decorator模式的方式提供生物群系的信息的。换句话说，它就像流水线一样，每个环节都对当前生物群系进行一次处理。
>
> ——ustc-zzzz《答知乎提问：Minecraft 的地形生成算法是什么？》

**层（Layer）**是生成生物群系的重要工具。世界好比一块画布，“层‘就是画布上涂刷的一层层的颜料。最后得到的画作便是每一层颜料共同作用的结果。不难看出，每一层都可以描述为一个函数。

#### 元

我们可以大致把层分为三种：原始层、一元层、二元层。

原始层就是画布最初的样子。可以被描述为 

`OriginLayer: (x, z) -> Biome`

一元层就是在现有层的基础上再加一层。可以被描述为

`UnaryLayer: (x, z, parent: Layer) -> Biome`

二元层能合并两个画布上的内容，可以认为是两个层的叠加。可以被描述为

`BinaryLayer: (x, z, mother: Layer, father: Layer) -> Biome`

注意到，所有层都有`x, z`这样的二元组来表示 x 和 z 相同的 16 个区域。

#### 远亲不如近邻

一个区域的生物群系，往往与周围的区域的生物群系有关。层为了处理周围的生物群系，往往也需要周围的生物群系作为参考。我们大致可以把这样的参考关系分为三种：

普通层：不参考附近的生物群系

車层：参考东南西北四个方向的区域的生物群系

象层：参考东北、西北、东南、西南四个方向的区域的生物群系。

下文会用四周（車）和四周（象）来区分这后两种情况。

|    名称    |          方向          |             字符画             |
| :--------: | :--------------------: | :----------------------------: |
| 四周（車） |     东、南、西、北     | □ ■ □<br/>■ + ■<br/>□ ■ □<br/> |
| 四周（象） | 东北、西北、东南、西南 | ■ □ ■<br/>□ × □<br/>■ □ ■<br/> |

### 三条线

主世界的生物群系就是用上面介绍的层生成的。根据层层叠加的关系，可以分为三条线，我把他们取名为**main（主线）、river（河流支线） 和 ocean（海洋支线）**。

这里简述一下支线的大致情况：海洋支线极为简单，在创建之后简单处理后便直接与主线合并。而河流支线复杂绵长，且不仅最终层被合并到了主线，中间层也被主线用作参考，不过好在河流支线并没有反过来参考主线。

下面我们以主线为视角出发来叙述整个过程，这难免造成穿插其中支线叙述的混乱。

在每一段解释的**前面**都配有一张或者几张对应的图，图中的像素的颜色代表不同的含义，除了主线的最后一张经过打磨之后可以精确到每一个方块，每一张图的色块其实都是由 4 x 4 的像素组成的，代表了一个区域里的 16 个方块。所有图的大小都是 1600 x 900 也就是 400 x 225 个区域。所有的图都遵循着上北下南左西右东的原则。此外为了解释放大化我还专门准备了一张图。

### 主线

![](layers/main/0.png)

#### 原始层：第一阶段

主线的第一阶段并非用实际上的生物群系来标记区域的，而是用 1、2、3、4 来表示大陆区域的温度，海洋、深海和蘑菇岛仍然使用生物群系 id 表示（混合表示法）。

主线的原始层 90% 被海洋覆盖，剩下 10% 是炎热大陆，是随机分布的。特别地，区域`0, 0`一定是炎热大陆。这就是你为什么有时候会出生在小岛上面，但是基本上不会直接被扔水里。

![](layers/main/1.png)

锯齿放大化，这是唯一一次又是使用锯齿放大化，而不是普通的放大化。

#### 放大化

**放大化（Zoom）**将原本占有一个区域的生物群系扩散到 2 x 2 的四个区域。注意这个放大化和**放大化**世界类型没有关系，反倒是和**巨型生物群系**世界类型有关系，后面会提到。有的时候翻译总是那么捉弄人，就像上文提到的区域一样，不是吗？

![](Zoom.png)

如图所示（m ≥ 0, n ≥ 0，负半轴与此图水平、垂直镜像），方格外的坐标表示的是放大化之后的区域坐标，方格里面标有坐标的表示的是放大化之前对应的区域坐标，表示与原该坐标对应生物群系一致。接下来游戏会分别生成 A、B、C 三个区域的生物群系。我们不妨把`n, m`、`n, m + 1`、`n + 1, m`、`n + 1, m + 1`的生物群系分别记为 a、b、c、d。A 的生物群系即在 a 和 b 中随机选择一个，B的生物群系即在 a 和 c 的生物群系中随机选择一个。对于 C 的处理，两种放大化各有不同。如果是锯齿放大化，则直接随机选择四个其中的一个。如果是普通的放大化，则按照少数服从多数的原则进行挑选，具体规则如下：

- 如果存在三个相同的（如 a = b = c），那么就选择这一种（a）。
- 否则如果存在两个相同的，且另外两个各自不同（如 a = b 且 c ≠ d），那么就选择这一种（a）。
- 否则就不存在“多数”了，所以只能直接随机选择四个其中的一个。

![](layers/main/2.png)

#### 扩张

实际上扩张不总是陆地在扩张，如果有有兴趣的朋友可以去细致对比一下：有的时候是海洋扩张了。不过总体来看陆地扩张较多。

这种层在第二阶段也被使用，与第一阶段的混合表示法不同，第二阶段的幻数直接表示生物群系。在 MC 中，炎热和平原的幻数均为 1，而寒冷和森林的幻数均为 4。为了表述方便，下文用_热原_和_冷森_来表示幻数 1 和 4。

- 如果自己不是海，四周（象）其中一个是海，那自己就会变成海（除非自己是_冷森_，就还是_冷森_）。

- 否则如果四周（象）也是海，那自己就还是海。

- 否则变为_热原_，有一定概率变为四周（象）的生物群系。

最后这一分支计算比较复杂，不便于口述，干脆直接代码奉上（其中`context.nextInt(n)`生成一个位于`[0, n)`的随机噪声）。

```Java
int i = 1;
int ret = HOT_OR_PLAINS;
if (!isShallowOcean(northeast) && context.nextInt(i++) == 0) ret = northeast;
if (!isShallowOcean(northwest) && context.nextInt(i++) == 0) ret = northwest;
if (!isShallowOcean(southwest) && context.nextInt(i++) == 0) ret = southwest;
if (!isShallowOcean(southeast) && context.nextInt(i++) == 0) ret = southeast;

return context.nextInt(3) == 0 ? ret : ret == COLD_OR_FOREST ? COLD_OR_FOREST : center;
```

![](layers/main/3.png)

放大化。

![](layers/main/4.png)
![](layers/main/5.png)
![](layers/main/6.png)

三次扩张。如果看过 1.6 生物群系图的朋友应该能看出这其实就是整个世界的雏形了。从图可看出，所有海洋都是联通的，海洋总面积过半。

![](layers/main/7.png)

#### 抽干海洋

这一层_可以认为_是在 1.7 加入的。不难看出，前面扩大陆地这么多次，不如这一次来的效率高。图可看出，与之前恰恰相反：几乎所有陆地都是联通的，陆地总面积过半

![](layers/main/8.png)

#### 降温

将原本有的炎热大陆群系变为冰冷和凉爽，各有 1/6 的概率。剩下的 2/3 陆地还是炎热。

![](layers/main/9.png)

扩张

![](layers/main/10.png)

转化：凉爽化。

![](layers/main/11.png)

转化：温暖化。

![](layers/main/12.png)

转化：稀有化。

#### 转化

这个名字非常平庸，我胡乱起的。主要原因是第三个和前两个几乎毫无联系。

凉爽化：如果自己是炎热，且周围（車）是凉爽或寒冷，就变成温暖。

温暖化：如果自己是寒冷，且周围（車）是炎热或温暖，就变成凉爽。

稀有化：如果自己不是海，就有 1/13 的几率进行不可描述之事：
```Java
value |= 1 + context.nextInt(15) << 8 & 0xF00;
```
其中 value 就是这个区域的生物群系 id。注意运算符优先级哦。可以看出，这个数字的高位被标记了一下。后面这个标记的数字会派上用场。我用另一种颜色的像素来表示这样的区域。

![](layers/main/13.png)
![](layers/main/14.png)

两次放大化

![](layers/main/15.png)

扩张

![](layers/main/16.png)

#### 蘑菇岛

把 1% 的四周（象）也是海洋的海洋区域变为蘑菇岛区域。

![](layers/main/17.png)

#### 加入深海

将四周（車）也是海洋的海洋区域变为深海区域。

河流支线：[水源](#水源)

![](layers/main/18.png)

#### 生物群系层：第二阶段

**生物群系层（BiomeLayer）**是最为关键的一层之一。这一次实际上选择了具体的生物群系。前面的海洋、深海、蘑菇岛不变，其余区域按下列规则选择生物群系：

- 先选择行：如果之前区域的低位不属于下表第一列中任何一个，即为蘑菇岛。
- 除寒冷之外，若之前区域高位有（转化：稀有化中提到的）数字，则取稀有列，否则取普通列。寒冷只有普通列。
- 行和列都确定了，选中格子后随机选择格子中的一个生物群系，后面的数字表示权重。没有数字默认为 1

| 之前区域 | 普通                                        | 稀有                             |
| -------- | ------------------------------------------- | -------------------------------- |
| 炎热     | 沙漠（3）<br/>热带草原（2）<br/>平原        | 恶地高原<br/>繁茂的恶地高原（2） |
| 温暖     | 森林、黑森林、山地<br/>平原、桦木森林、沼泽 | 丛林                             |
| 凉爽     | 森林、山地、针叶林、平原                    | 巨型针叶林                       |
| 寒冷     | 积雪的冻原（3）<br/>积雪的针叶林            | -                                |

如果前面的区域图只是一块干巴巴的面包片，这一层浇上去的便是五彩的酱汁。

![](layers/main/19.png)

#### 竹林

把 10% 的丛林变成竹林

![](layers/main/20.png)
![](layers/main/21.png)

两次放大化

![](layers/main/22.png)

加入边缘

![](layers/main/23.png)

加入丘陵

**边缘（Edge）**、**丘陵（Hills）**、**海滩（Shore）**是 MC 插入在两种不同生物群系中间用于过渡的生物群系，海滩会在后文中提到，下面讲解的是边缘和丘陵。

#### 相似生物群系

这里我们引入相似生物群系的概念。

出于易于理解的目的，相似可以近似解释为：

- 相同的生物群系相似

- 类别相同且均不为 none 的生物群系相似

但是 Mojang 为平顶山生物群系做了特化，导致判断相似的方法是一个不对称的方法（即存在 `a` 和 `b` 两个生物群系使得，`areSimilar(a, b) != areSimilar(b, a)`），因此下面给出我整理后的等效方法：

```Java
boolean areSimilar(Biome biome1, Biome biome2) {
   if (biome1 == biome2) return true;
   return biome1 == WOODED_BADLANDS_PLATEAU || biome1 == BADLANDS_PLATEAU
         ? biome2 == WOODED_BADLANDS_PLATEAU || biome2 == BADLANDS_PLATEAU
         : biome1.getCategory() != Category.NONE 
         && biome2.getCategory() != Category.NONE
         && biome1.getCategory() == biome2.getCategory();
}
```

可以看出，当 `biome1` 为恶地高原或者繁茂恶地高原时，`biome2` 也必须是恶地高原或者繁茂恶地高原才能相似。但是 `biome2` 为恶地高原或者繁茂恶地高原却不需要 `biome1` 是恶地高原或者繁茂恶地高原，（根据后面的分支）只需要类别是恶地即可相似。

我不想用左相似、右相似这样奇怪的说法来区分这两种情况，下文所述的

> a 相似于 b

指的就是 `areSimilar(a, b)`。

> 相似于 b 的生物群系

指的是 `areSimilar(/*这些生物群系*/, b) == true`

#### 边缘

[前文提到](#失落的属性：温度类别)，山地边缘作为一个 1.7.2 开始就不再生成的边缘生物群系，在世界生成的代码里，并非真的消失——实际上 MC 第一个试图生成的边缘生物群系就是它！但结果总是失败，为什么呢？

这里直接上代码可能会好理解一些，但是不借助代码也可以讲清楚。对_山地生物群系_（常量）和四周（車）每一个区域的生物群系调用下面的函数，如果**全部**为 true，说明自己不能变成山地边缘。

```Java
boolean cannotBecomeMtEdge(Biome biome1, Biome biome2) {
   if (areSimilar(biome1, biome2)) return true;
   TemperatureCategory type1 = biome1.getTemperatureCategory();
   TemperatureCategory type2 = biome2.getTemperatureCategory();
   return type1 == type2 
       || type1 == TemperatureCategory.MEDIUM 
       || type2 == TemperatureCategory.MEDIUM;
}
```

这个函数会在这些情况下为 true：

- 两个生物群系相似，即相似于_山地生物群系_
- 温度类别相同，或其中一个是中

如果表面上观察，一切似乎很合理。不过，山地生物群系的温度类别是什么？相信读者读到这里，答案呼之欲出了：中。没错，无论另一个生物群系的温度类别是什么，最后一个语句都相当于一个`return true`。进而得到这个函数相当于`areSimilar(biome1, biome2) ? true : true`：这两个生物群系相似也是 true，不相似也是 true，说白了永远是 true——因此直接排除了所有的区域！山地边缘自此成了笑话：后文其实仍有关于山地边缘的判断、尝试，我于是一并忽略、删去。

接下来行为等价于按照表格一行一行进行尝试：

| 如果自己是... | 且四周（車）任意一个不相似于... | 自己就变为... |
| ------------- | :-----------------------------: | ------------: |
| 繁茂恶地高原  |              自己               |          恶地 |
| 恶地高原      |              自己               |          恶地 |
| 巨型针叶林    |              自己               |        针叶林 |

| 如果自己是... |   且四周（車）任意一个是...    | 自己就变为... |
| ------------- | :----------------------------: | ------------: |
| 沙漠          |           积雪的冻原           |    繁茂的山地 |
| 沼泽          | 沙漠、积雪的针叶林或积雪的冻原 |          平原 |
| 沼泽          |           丛林或竹林           |      丛林边缘 |

如果都这些尝试都失败了，就维持现状。

#### 丘陵

丘陵层一个二元层，一个参数是主线层，另一个是河流层。主线层的生物群系记为`a`。前文提到，河流层生成的是`[0+2, 299999+2)`之间的一个随机噪声，而丘陵层使用的数据是该层减 2，即`[0, 299999)`，并对 29 取模记为`r`。

第一次尝试成功的条件是：如果`a`不是浅海且不是变种生物群系，同时`r`为 1 。

如果成功：

- 如果`a`有变种就变为`a`的变种

- 如果`a`没有变种就保持`a`不变

如果失败，则进入第二次尝试：

- 当`r`不为 0 时，就有 1 / 3 的概率进入第二次尝试，并根据`a`选择对应的丘陵生物群系记为`h`。如果没有对应的`h`，这次尝试也会失败。把`h`记为`ret`。

- 当`r`为 0 时，直接进入第二次尝试，并根据`a`选择对应的丘陵生物群系及其变种记为`h`和`mh`。如果没有对应的`h`，或者`h`没有变种，这次尝试也会失败。把`mh`记为`ret`。

如果四周（車）至少有 3 个区域的生物群系相似于`a`，尝试成功，该区域变为`ret`。如果上述尝试都失败，就保持`a`不变。

下表是经过我整理后得出，在这里可能出现的原生物群系与对应丘陵生物群系的对照表。和上文相同，括号里的数字代表权值，没有数字默认为 1。

| 原生物群系 | 丘陵生物群系 |
| ------------ | --------------------------- |
| 沙漠         | 沙漠丘陵                    |
| 森林         | 繁茂丘陵                    |
| 桦木森林     | 桦木森林丘陵                |
| 黑森林       | 平原                        |
| 针叶林       | 针叶林丘陵                  |
| 巨型针叶林   | 巨型针叶林丘陵              |
| 积雪的针叶林 | 积雪的针叶林丘陵            |
| 平原         | 繁茂山地、森林（2） |
| 积雪的冻原   | 积雪的冻原丘陵              |
| 丛林 | 丛林丘陵 |
| 竹林 | 竹林丘陵 |
| 海洋 | 深海 |
| 山地 | 繁茂山地                    |
| 热带草原 | 热带高原 |
| 类别为恶地 | 恶地 |
| 1 / 3 的深海 | 平原、森林 |

![](layers/main/24.png)

#### 向日葵平原

把 1/57 的平原变为向日葵平原

[支链链接](#河流距离)

![](layers/main/25.png)
![](layers/main/26.png)
![](layers/main/27.png)
![](layers/main/28.png)

#### 生物群系大小

上图连续放大了四次，其中前两次还夹带了私活，这一阶段实际上是根据世界生成的一个重要参数——**生物群系大小（BiomeSize）**进行的。原版的**默认（Default）**世界类型这个数字是 4，而**巨型生物生物群系（LargeBiomes）**世界类型这个数字是6。根据前面对放大化的解释可以知道，巨型生物群系的生物群系的面积将会是默认的 16 倍，即 x 和 z 方向各 4 倍。

在第一次放大化完成之后，将会再进行最后一次扩张。详解见上文扩张一节。

在第二次放大化完成之后（如果生物群系大小仅为 1，则在扩张完成后），添加海滩生物群系。

#### 海滩

生成海滩的前提是自己不是海、不是沼泽。原则是：现在第一列找到自己的类别，判断周围的条件，如果失败就不再尝试、维持现状。唯一的例外是丛林有两次机会。

| 自己                         | 周围（車）             | 海岸       |
| ---------------------------- | ---------------------- | ---------- |
| 蘑菇岛                       | 任意一个是浅海              | 蘑菇岛海岸 |
| 类别为丛林                   | 任意一个不兼容丛林<sup>1</sup> | 丛林边缘   |
| 类别为丛林 | 任意一个是海洋                          | 沙滩       |
| 山地或繁茂山地               | 任意一个是海洋    | 石滩       |
| 降水类型为雪                 | 任意一个是海洋    | 积雪的沙滩 |
| 恶地或<br/>繁茂的恶地高原 | 任意一个类别不是恶地<br/>且全都不是海洋 | 沙漠 |
| 其它 | 任意一个是海洋 | 沙滩 |

<sup>1</sup>兼容丛林的生物群系有：类别为丛林的生物群系、森林、针叶林、海洋


![](layers/main/29.png)

#### 平滑

平滑层会根据四周（車）的生物群系改变自己的生物群系，规则如下：

- 若东等于西且南等于北，则随机选择西或北
- 若仅东等于西，则选择西
- 若仅南等于北，则选择北
- 上述尝试都失败，维持现状。

![](layers/main/30.png)

#### 混合河流

[支线链接](#合并河流)

如果主线是海洋，或河流支线不是河流（7），就维持原状，否则根据下表选择一个河流。

| 原生物群系         | 河流生物群系 |
| ------------------ | ------------ |
| 积雪的冻原         | 冻河         |
| 蘑菇岛或蘑菇岛海滩 | 蘑菇岛海滩   |
| 其他               | 河流         |

![](layers/main/31.png)

#### 混合海洋

[支线链接](#海洋支线)

创建、合并了海洋支线，使主线层的海水有了温度。可惜这幅图中无法体现，因为刚好没出现其他温度的海洋。

混合规则：如果周围 16 x 16 的区域有非海洋区域，暖水海洋变为温水，冻洋变为冷水海洋。否则，如果主线层是深海，还会对海洋支线层传来的浅海转变为对应的**深海**生物群系。注意：暖水海洋**不会**进行这样的转换。

至此，所有层的工作都完成了。所得的便是每一个区域的生物群系。这些生物群系会被缓存到每个区块中，稍后会提到这样的缓存。

![](layers/main/32.png)

#### 最后一步：动态打磨

接下来是具体的每一个方块的动态打磨。其行为难以语言描述，故直接给出我整理之后用在 DigHog 里面的代码。

```Java
public static int get(long hash, int x, int y, int z, Area underlying) {
    int x_2 = x - 2;
    int y_2 = y - 2;
    int z_2 = z - 2;
    int cx = x_2 >> 2;
    int cy = y_2 >> 2;
    int cz = z_2 >> 2;
    double lx = (x_2 & 3) / 4.0;
    double ly = (y_2 & 3) / 4.0;
    double lz = (z_2 & 3) / 4.0;

    int flag = 0;
    double min = Double.POSITIVE_INFINITY;
    for (int i = 0; i < 8; ++i) {
        boolean high = (i & 4) == 0;
        boolean mid = (i & 2) == 0;
        boolean low = (i & 1) == 0;
        int mcx = high ? cx : cx + 1;
        int mcy = mid ? cy : cy + 1;
        int mcz = low ? cz : cz + 1;
        double mlx = high ? lx : lx - 1;
        double mly = mid ? ly : ly - 1;
        double mlz = low ? lz : lz - 1;
        double buf = DHMath.supermix(hash, mcx, mcy, mcz, mlx, mly, mlz);
        if (min > buf) {
            flag = i;
            min = buf;
        }
    }
    int mx = (flag & 4) == 0 ? cx : cx + 1;
    //int my = (flag & 2) == 0 ? cy : cy + 1;
    int mz = (flag & 1) == 0 ? cz : cz + 1;
    return underlying.get(mx, mz);
}
```

实际上在原版代码中`underlying`总是会接受`my`的，但是无论是哪一个生物群系最后都直接忽略了，所以这里我的代码也没写进去。但是请注意：`my`虽然不起作用，`y`却实打实参与了计算，且影响了最终结果。因此虽然 x 和 z 相同 y 不同的区域总是包含相同的生物群系，但是打磨了之后会得到不同结果。当然了这种差异仅仅在两个生物群系的边界会存在且十分微小难以观测，所以其实没什么实际意义。不过主世界的`y`在传入之前就被改为了 0，所以主世界的生物群系与 `y` 无关。至此，我们就得到了主世界每一个方块的生物群系。

----

在我的测试中发现，这个方法消耗的时间竟然是前面所有层（包括支线）消耗时间的两倍左右。罪魁祸首是`DHMath.supermix(hash, mcx, mcy, mcz, mlx, mly, mlz)`被频繁调用。

原版在求最小值的时候并没有采用我上面的方法，而是先存进一个`new double[8]`，再求其中的最小值。这直接导致了大量double数组频繁地被创建又被回收。

### 河流支线

![](layers/river/0.png)

#### 水源

[主线链接](#加入深海)

浅海区域的保持不变为 0。非海洋区域生成一个位于区间`2 + [0, 299999) = [2, 300000]`中的随机噪声。但实际上，最终这个噪声只会进行奇偶性的判断，故我用两种不同的灰色区别了奇偶。

![](layers/river/1.png)
![](layers/river/2.png)

紧接着：两次放大化

![](layers/river/3.png)
![](layers/river/4.png)
![](layers/river/5.png)
![](layers/river/6.png)

#### 河流距离

[主线链接](#向日葵平原)

河流支线先被放大化。放大的次数取决于<sub>官方名称叫</sub>**河流大小（RiverSize）**，而我更偏向于叫它**河流距离（RiverDistance）**。因为这个数值越大，河流之间的间距越大，而河流宽度并不会受此影响。默认为 4，**自定义（Customized）**世界类型删除后便无法修改。接着迎接河流支线的是河流层和平滑层。

值得注意的是，生物群系大小的默认值和河流距离的默认值都是 4，也造就了在默认世界中河流更贴合生物群系边界的景观。

![](layers/river/7.png)

#### 河流

紧接着：河流层会对之前河流之前传来的数据做处理：

- 如果是海洋，保持海洋 0 不变。

- 如果大于等于 2，也就是河流，奇数取 3，偶数取 2。

如果自己处理后得到的数字和四周（車）处理后得到的数字全部相同，则该区域非河流（-1，图中用灰色标识），反之为河流（7）。

![](layers/river/8.png)

紧接着：[平滑](#平滑)

![](layers/main/30.png)

#### 合并河流

[主线链接](#混合河流)

最后河流支线被合并


### 海洋支线

![](layers/ocean/0.png)

[主线链接](#混合海洋)

海洋支线的第一层，利用噪声算法，生成不同温度的**浅海**。

![](layers/ocean/1.png)
![](layers/ocean/2.png)
![](layers/ocean/3.png)
![](layers/ocean/4.png)
![](layers/ocean/5.png)
![](layers/ocean/6.png)

紧接着：六次放大化

非常有趣的一点：这里的放大化次数不会因为 biomeSize 的改变而改变，导致巨型生物群系世界类型下的河流和默认世界类型下的河流大小、位置几乎无差，所以看上去不像默认世界类型那样契合生物群系边界。

![](layers/main/31.png)

紧接着：最后海洋支线被合并

至此，两条支线的故事也已经讲完。


## 其他生物群系来源

> 目前这里只介绍主世界正常情况下的生成，下界和末界或者超平坦什么的再说（可能我会回来填坑呢）。
>
> ——ustc-zzzz《答知乎提问：Minecraft 的地形生成算法是什么？》

### 固定生物群系

**固定（Fixed）**生物群系，说白了，就是全世界都是一种生物群系。最经典的例子便是**超平坦（Superflat）**世界类型。旧版本的**自定义**、新版本的**自选（Buffet）**和**调试（Debug）**世界类型也可以实现。超平坦的默认和调试世界类型的生物群系都是平原。

----

**虚空（The Void）**生物群系只会生成一个 33 x 1 x 33 的石头平台以及最中间的一个圆石的生物群系，最简单的方式就是通过超平坦预设来创建。这个生物群系不会生成生物，因此不适合测试刷怪的特性；但正因为如此，没有烦人的史莱姆，这里成了测试其他特性的好地方。

----

在旧版本，下界和末地的生物群系在维度内都是完全一样的。因此也使用了这种来源。这也是上面的引用中土球将它们并列的原因。在后面的更新中：

- 末地在 1.9 在 x 和 z 上有了不同的生物群系

- 末地在 1.15 在 y 上有不同的生物群系

- 下界在 1.16 在 x y z 上有不同的生物群系

下面详细介绍这两个维度的生物群系。

### 末地的生物群系

![](the-end/0.png)

**末路之地（The End）**分为两部分：主岛和外岛。注意：在末地，有生物群系不代表就有陆地——生物群系无处不在，陆地却是漂浮、破碎而游离的。末地生物群系来源配置需要的参数是种子，也就是说末地的生物群系分布只与种子有关。

----

主岛的生物群系是末地（the_end），生物群系半径为 256 格，但主岛陆地半径一般只有一百格左右。距离原点大约 _**42**_ 格的地方，会生成十根黑曜石柱子。

----

外岛由四种生物群系构成：他们由噪声生成，从高到低分别是：末地高地（紫）、末地中型岛屿（蓝）、末地小型岛屿（深蓝）、末地荒岛（浅蓝）。高地被低地层层包围，整个末地的生物群系图看起来像无数簇拥的细胞。

末地高地和中型岛屿基本上是整块的大陆，上面会生成末地城结构，高地还有紫颂果。小型岛屿和荒岛基本上都是破碎的小岛，贫瘠荒芜。但是这些地方都可以生成折跃门。

----

![](the-end/1.png)

^y=0

![](the-end/2.png)

^y=64

区域生成好后，就是动态打磨。前文讲主世界时已经提到过。但与主世界不同，这里的 y 不再是常数 0，而是传入实实在在的具体的高度，换一个 y 就会得到不一样的结果，这种变化只对不同生物群系的交界处有影响。

### 下界的生物群系

#### 


![](the-nether/0.png)

[TODO]

----

![](the-nether/1.png)

^y=0

![](the-nether/2.png)

^y=64

[TODO]

动态打磨，跟末地一样，y 不同生物群系可能不同，这种变化只对不同生物群系的交界处有影响。


### 棋盘生物群系

![](checkerboard.png)

**棋盘（Checkerboard）** 是隐藏的生物群系来源。

[TODO]

## 生物群系缓存

[TODO]



## 结束语

[TODO]





## 附录

### 1.7 生物群系和 ID

方便起见，用的是 1.16 的 id。

| 生物群系                | id   | 变种生物群系（ID = id + 128）    | ID   |
| ----------------------- | ---- | -------------------------------- | ---- |
| ocean                   | 0    |                                  |      |
| plains                  | 1    | sunflower_plains                 | 129  |
| desert                  | 2    | desert_lakes                     | 130  |
| mountains               | 3    | gravelly_mountains               | 131  |
| forest                  | 4    | flower_forest                    | 132  |
| taiga                   | 5    | taiga_mountains                  | 133  |
| swamp                   | 6    | swamp_hills                      | 134  |
| river                   | 7    |                                  |      |
| nether_wastes           | 8    |                                  |      |
| the_end                 | 9    |                                  |      |
| frozen_ocean            | 10   |                                  |      |
| frozen_river            | 11   |                                  |      |
| snowy_tundra            | 12   | ice_spikes                       | 140  |
| snowy_mountains         | 13   |                                  |      |
| mushroom_fields         | 14   |                                  |      |
| mushroom_field_shore    | 15   |                                  |      |
| beach                   | 16   |                                  |      |
| desert_hills            | 17   |                                  |      |
| wooded_hills            | 18   |                                  |      |
| taiga_hills             | 19   |                                  |      |
| mountain_edge           | 20   |                                  |      |
| jungle                  | 21   | modified_jungle                  | 149  |
| jungle_hills            | 22   |                                  |      |
| jungle_edge             | 23   | modified_jungle_edge             | 151  |
| deep_ocean              | 24   |                                  |      |
| stone_shore             | 25   |                                  |      |
| snowy_beach             | 26   |                                  |      |
| birch_forest            | 27   | tall_birch_forest                | 155  |
| birch_forest_hills      | 28   | tall_birch_hills                 | 156  |
| dark_forest             | 29   | dark_forest_hills                | 157  |
| snowy_taiga             | 30   | snowy_taiga_mountains            | 158  |
| snowy_taiga_hills       | 31   |                                  |      |
| giant_tree_taiga        | 32   | giant_spruce_taiga               | 160  |
| giant_tree_taiga_hills  | 33   | giant_spruce_taiga_hills         | 161  |
| wooded_mountains        | 34   | modified_gravelly_mountains      | 162  |
| savanna                 | 35   | shattered_savanna                | 163  |
| savanna_plateau         | 36   | shattered_savanna_plateau        | 164  |
| badlands                | 37   | eroded_badlands                  | 165  |
| wooded_badlands_plateau | 38   | modified_wooded_badlands_plateau | 166  |
| badlands_plateau        | 39   | modified_badlands_plateau        | 167  |

### 生物群系属性表

#### 温度、降水量、深度和规模表

下表列出的是 1.16 所有生物群系的温度、降水量、深度和规模。最小值和最大值被放在了最后。

| 名称                             | 温度 | 降水量 | 深度   | 规模   |
| -------------------------------- | ---- | ------ | ------ | ------ |
| ocean                            | 0.5  | 0.5    | -1     | 0.1    |
| plains                           | 0.8  | 0.4    | 0.125  | 0.05   |
| desert                           | 2    | 0      | 0.125  | 0.05   |
| mountains                        | 0.2  | 0.3    | 1      | 0.5    |
| forest                           | 0.7  | 0.8    | 0.1    | 0.2    |
| taiga                            | 0.25 | 0.8    | 0.2    | 0.2    |
| swamp                            | 0.8  | 0.9    | -0.2   | 0.1    |
| river                            | 0.5  | 0.5    | -0.5   | 0      |
| nether_wastes                    | 2    | 0      | 0.1    | 0.2    |
| the_end                          | 0.5  | 0.5    | 0.1    | 0.2    |
| frozen_ocean                     | 0    | 0.5    | -1     | 0.1    |
| frozen_river                     | 0    | 0.5    | -0.5   | 0      |
| snowy_tundra                     | 0    | 0.5    | 0.125  | 0.05   |
| snowy_mountains                  | 0    | 0.5    | 0.45   | 0.3    |
| mushroom_fields                  | 0.9  | 1      | 0.2    | 0.3    |
| mushroom_field_shore             | 0.9  | 1      | 0      | 0.025  |
| beach                            | 0.8  | 0.4    | 0      | 0.025  |
| desert_hills                     | 2    | 0      | 0.45   | 0.3    |
| wooded_hills                     | 0.7  | 0.8    | 0.45   | 0.3    |
| taiga_hills                      | 0.25 | 0.8    | 0.45   | 0.3    |
| mountain_edge                    | 0.2  | 0.3    | 0.8    | 0.3    |
| jungle                           | 0.95 | 0.9    | 0.1    | 0.2    |
| jungle_hills                     | 0.95 | 0.9    | 0.45   | 0.3    |
| jungle_edge                      | 0.95 | 0.8    | 0.1    | 0.2    |
| deep_ocean                       | 0.5  | 0.5    | -1.8   | 0.1    |
| stone_shore                      | 0.2  | 0.3    | 0.1    | 0.8    |
| snowy_beach                      | 0.05 | 0.3    | 0      | 0.025  |
| birch_forest                     | 0.6  | 0.6    | 0.1    | 0.2    |
| birch_forest_hills               | 0.6  | 0.6    | 0.45   | 0.3    |
| dark_forest                      | 0.7  | 0.8    | 0.1    | 0.2    |
| snowy_taiga                      | -0.5 | 0.4    | 0.2    | 0.2    |
| snowy_taiga_hills                | -0.5 | 0.4    | 0.45   | 0.3    |
| giant_tree_taiga                 | 0.3  | 0.8    | 0.2    | 0.2    |
| giant_tree_taiga_hills           | 0.3  | 0.8    | 0.45   | 0.3    |
| wooded_mountains                 | 0.2  | 0.3    | 1      | 0.5    |
| savanna                          | 1.2  | 0      | 0.125  | 0.05   |
| savanna_plateau                  | 1    | 0      | 1.5    | 0.025  |
| badlands                         | 2    | 0      | 0.1    | 0.2    |
| wooded_badlands_plateau          | 2    | 0      | 1.5    | 0.025  |
| badlands_plateau                 | 2    | 0      | 1.5    | 0.025  |
| small_end_islands                | 0.5  | 0.5    | 0.1    | 0.2    |
| end_midlands                     | 0.5  | 0.5    | 0.1    | 0.2    |
| end_highlands                    | 0.5  | 0.5    | 0.1    | 0.2    |
| end_barrens                      | 0.5  | 0.5    | 0.1    | 0.2    |
| warm_ocean                       | 0.5  | 0.5    | -1     | 0.1    |
| lukewarm_ocean                   | 0.5  | 0.5    | -1     | 0.1    |
| cold_ocean                       | 0.5  | 0.5    | -1     | 0.1    |
| deep_warm_ocean                  | 0.5  | 0.5    | -1.8   | 0.1    |
| deep_lukewarm_ocean              | 0.5  | 0.5    | -1.8   | 0.1    |
| deep_cold_ocean                  | 0.5  | 0.5    | -1.8   | 0.1    |
| deep_frozen_ocean                | 0.5  | 0.5    | -1.8   | 0.1    |
| the_void                         | 0.5  | 0.5    | 0.1    | 0.2    |
| sunflower_plains                 | 0.8  | 0.4    | 0.125  | 0.05   |
| desert_lakes                     | 2    | 0      | 0.225  | 0.25   |
| gravelly_mountains               | 0.2  | 0.3    | 1      | 0.5    |
| flower_forest                    | 0.7  | 0.8    | 0.1    | 0.4    |
| taiga_mountains                  | 0.25 | 0.8    | 0.3    | 0.4    |
| swamp_hills                      | 0.8  | 0.9    | -0.1   | 0.3    |
| ice_spikes                       | 0    | 0.5    | 0.425  | 0.45   |
| modified_jungle                  | 0.95 | 0.9    | 0.2    | 0.4    |
| modified_jungle_edge             | 0.95 | 0.8    | 0.2    | 0.4    |
| tall_birch_forest                | 0.6  | 0.6    | 0.2    | 0.4    |
| tall_birch_hills                 | 0.6  | 0.6    | 0.55   | 0.5    |
| dark_forest_hills                | 0.7  | 0.8    | 0.2    | 0.4    |
| snowy_taiga_mountains            | -0.5 | 0.4    | 0.3    | 0.4    |
| giant_spruce_taiga               | 0.25 | 0.8    | 0.2    | 0.2    |
| giant_spruce_taiga_hills         | 0.25 | 0.8    | 0.2    | 0.2    |
| modified_gravelly_mountains      | 0.2  | 0.3    | 1      | 0.5    |
| shattered_savanna                | 1.1  | 0      | 0.3625 | 1.225  |
| shattered_savanna_plateau        | 1    | 0      | 1.05   | 1.2125 |
| eroded_badlands                  | 2    | 0      | 0.1    | 0.2    |
| modified_wooded_badlands_plateau | 2    | 0      | 0.45   | 0.3    |
| modified_badlands_plateau        | 2    | 0      | 0.45   | 0.3    |
| bamboo_jungle                    | 0.95 | 0.9    | 0.1    | 0.2    |
| bamboo_jungle_hills              | 0.95 | 0.9    | 0.45   | 0.3    |
| soul_sand_valley                 | 2    | 0      | 0.1    | 0.2    |
| crimson_forest                   | 2    | 0      | 0.1    | 0.2    |
| warped_forest                    | 2    | 0      | 0.1    | 0.2    |
| basalt_deltas                    | 2    | 0      | 0.1    | 0.2    |
| 最小值                           | -0.5 | 0      | -1.8   | 0      |
| 最大值                           | 2    | 1      | 1.5    | 1.225  |

#### 类别、降水类型表

类别名字上，原版存在一些历史遗留，故更正如下。

| 原版类别名    | 本文类别名 |
| ------------- | ---------- |
| extreme_hills | mountains  |
| mesa          | badlands   |

下表列出的是 1.16 所有生物群系的类别、降水类型。

| 名称                             |   类别    | 降水类型 |
| :------------------------------- | :-------: | :------: |
| ocean                            |   ocean   |   rain   |
| plains                           |  plains   |   rain   |
| desert                           |  desert   |   none   |
| mountains                        | mountains |   rain   |
| forest                           |  forest   |   rain   |
| taiga                            |   taiga   |   rain   |
| swamp                            |   swamp   |   rain   |
| river                            |   river   |   rain   |
| nether_wastes                    |  nether   |   none   |
| the_end                          |  the_end  |   none   |
| frozen_ocean                     |   ocean   |   snow   |
| frozen_river                     |   river   |   snow   |
| snowy_tundra                     |    icy    |   snow   |
| snowy_mountains                  |    icy    |   snow   |
| mushroom_fields                  | mushroom  |   rain   |
| mushroom_field_shore             | mushroom  |   rain   |
| beach                            |   beach   |   rain   |
| desert_hills                     |  desert   |   none   |
| wooded_hills                     |  forest   |   rain   |
| taiga_hills                      |   taiga   |   rain   |
| mountain_edge                    | mountains |   rain   |
| jungle                           |  jungle   |   rain   |
| jungle_hills                     |  jungle   |   rain   |
| jungle_edge                      |  jungle   |   rain   |
| deep_ocean                       |   ocean   |   rain   |
| stone_shore                      |   none    |   rain   |
| snowy_beach                      |   beach   |   snow   |
| birch_forest                     |  forest   |   rain   |
| birch_forest_hills               |  forest   |   rain   |
| dark_forest                      |  forest   |   rain   |
| snowy_taiga                      |   taiga   |   snow   |
| snowy_taiga_hills                |   taiga   |   snow   |
| giant_tree_taiga                 |   taiga   |   rain   |
| giant_tree_taiga_hills           |   taiga   |   rain   |
| wooded_mountains                 | mountains |   rain   |
| savanna                          |  savanna  |   none   |
| savanna_plateau                  |  savanna  |   none   |
| badlands                         | badlands  |   none   |
| wooded_badlands_plateau          | badlands  |   none   |
| badlands_plateau                 | badlands  |   none   |
| small_end_islands                |  the_end  |   none   |
| end_midlands                     |  the_end  |   none   |
| end_highlands                    |  the_end  |   none   |
| end_barrens                      |  the_end  |   none   |
| warm_ocean                       |   ocean   |   rain   |
| lukewarm_ocean                   |   ocean   |   rain   |
| cold_ocean                       |   ocean   |   rain   |
| deep_warm_ocean                  |   ocean   |   rain   |
| deep_lukewarm_ocean              |   ocean   |   rain   |
| deep_cold_ocean                  |   ocean   |   rain   |
| deep_frozen_ocean                |   ocean   |   rain   |
| the_void                         |   none    |   none   |
| sunflower_plains                 |  plains   |   rain   |
| desert_lakes                     |  desert   |   none   |
| gravelly_mountains               | mountains |   rain   |
| flower_forest                    |  forest   |   rain   |
| taiga_mountains                  |   taiga   |   rain   |
| swamp_hills                      |   swamp   |   rain   |
| ice_spikes                       |    icy    |   snow   |
| modified_jungle                  |  jungle   |   rain   |
| modified_jungle_edge             |  jungle   |   rain   |
| tall_birch_forest                |  forest   |   rain   |
| tall_birch_hills                 |  forest   |   rain   |
| dark_forest_hills                |  forest   |   rain   |
| snowy_taiga_mountains            |   taiga   |   snow   |
| giant_spruce_taiga               |   taiga   |   rain   |
| giant_spruce_taiga_hills         |   taiga   |   rain   |
| modified_gravelly_mountains      | mountains |   rain   |
| shattered_savanna                |  savanna  |   none   |
| shattered_savanna_plateau        |  savanna  |   none   |
| eroded_badlands                  | badlands  |   none   |
| modified_wooded_badlands_plateau | badlands  |   none   |
| modified_badlands_plateau        | badlands  |   none   |
| bamboo_jungle                    |  jungle   |   rain   |
| bamboo_jungle_hills              |  jungle   |   rain   |
| soul_sand_valley                 |  nether   |   none   |
| crimson_forest                   |  nether   |   none   |
| warped_forest                    |  nether   |   none   |
| basalt_deltas                    |  nether   |   none   |

#### 变种表

下表列出的是 1.16 所有有变种的生物群系的变种。

实际上这些变种都是 1.7 时代遗留下来的，之后再无新的变种。特列出 ID = id + 128 以供对照。

| id   | 名称                    | 变种                             | ID   |
| ---- | ----------------------- | -------------------------------- | ---- |
| 1    | plains                  | sunflower_plains                 | 129  |
| 2    | desert                  | desert_lakes                     | 130  |
| 3    | mountains               | gravelly_mountains               | 131  |
| 4    | forest                  | flower_forest                    | 132  |
| 5    | taiga                   | taiga_mountains                  | 133  |
| 6    | swamp                   | swamp_hills                      | 134  |
| 12   | snowy_tundra            | ice_spikes                       | 140  |
| 21   | jungle                  | modified_jungle                  | 149  |
| 23   | jungle_edge             | modified_jungle_edge             | 151  |
| 27   | birch_forest            | tall_birch_forest                | 155  |
| 28   | birch_forest_hills      | tall_birch_hills                 | 156  |
| 29   | dark_forest             | dark_forest_hills                | 157  |
| 30   | snowy_taiga             | snowy_taiga_mountains            | 158  |
| 32   | giant_tree_taiga        | giant_spruce_taiga               | 160  |
| 33   | giant_tree_taiga_hills  | giant_spruce_taiga_hills         | 161  |
| 34   | wooded_mountains        | modified_gravelly_mountains      | 162  |
| 35   | savanna                 | shattered_savanna                | 163  |
| 36   | savanna_plateau         | shattered_savanna_plateau        | 164  |
| 37   | badlands                | eroded_badlands                  | 165  |
| 38   | wooded_badlands_plateau | modified_wooded_badlands_plateau | 166  |
| 39   | badlands_plateau        | modified_badlands_plateau        | 167  |

#### 气候参数表

下表列出的是 1.16 所有的气候参数。

由于原版的生物群系只有一个或没有气候参数，故只列出有气候参数的生物群系的唯一一个气候参数。

| 名称                | 温度  | 湿度 | 海拔  | 诡异度 | 偏移   |
| ------------------- | ----- | ---- | ----- | ------ | ------ |
| ocean               | 0.0   | 0.0  | -0.5  | 0.0    | 1.0    |
| plains              | 0.0   | 0.0  | 0.0   | 0.0    | 1.0    |
| desert              | 0.5   | -0.5 | 0.0   | 0.0    | 1.0    |
| nether_wastes       | 0.0   | 0.0  | 0.0   | 0.0    | 0.0    |
| snowy_tundra        | -0.5  | -0.5 | 0.0   | 0.0    | 1.0    |
| beach               | 0.0   | 0.0  | -0.1  | 0.0    | 0.9935 |
| jungle              | 0.5   | 0.5  | 0.0   | 0.0    | 1.0    |
| birch_forest        | -0.1  | 0.2  | 0.0   | 0.0    | 1.0    |
| birch_forest_hills  | -0.1  | 0.2  | 0.25  | 0.0    | 1.0    |
| badlands            | -0.25 | -0.5 | 0.5   | 0.2    | 1.0    |
| badlands_plateau    | -0.25 | -0.5 | 0.65  | 0.2    | 1.0    |
| warm_ocean          | 0.0   | 0.0  | -0.25 | 0.0    | 1.0    |
| bamboo_jungle       | 0.5   | 0.5  | 0.0   | 0.2    | 1.0    |
| bamboo_jungle_hills | 0.5   | 0.5  | 0.25  | 0.2    | 1.0    |
| soul_sand_valley    | 0.0   | -0.5 | 0.0   | 0.0    | 0.0    |
| crimson_forest      | 0.4   | 0.0  | 0.0   | 0.0    | 0.0    |
| warped_forest       | 0.0   | 0.5  | 0.0   | 0.0    | 0.375  |
| basalt_deltas       | -0.5  | 0.0  | 0.0   | 0.0    | 0.175  |

### 生物群系概率

#### 主世界生物群系概率

| 生物群系                         | 概率（‱，三位有效数字） |
| -------------------------------- | ----------------------- |
| ocean                            | 798                     |
| plains                           | 847                     |
| desert                           | 418                     |
| mountains                        | 632                     |
| forest                           | 832                     |
| taiga                            | 425                     |
| swamp                            | 323                     |
| river                            | 393                     |
| frozen_ocean                     | 51.8                    |
| frozen_river                     | 20.0                    |
| snowy_tundra                     | 349                     |
| snowy_mountains                  | 116                     |
| mushroom_fields                  | 3.01                    |
| mushroom_field_shore             | 2.04                    |
| beach                            | 322                     |
| desert_hills                     | 116                     |
| wooded_hills                     | 221                     |
| taiga_hills                      | 94.9                    |
| jungle                           | 95.4                    |
| jungle_hills                     | 32.8                    |
| jungle_edge                      | 8.47                    |
| deep_ocean                       | 797                     |
| stone_shore                      | 42.7                    |
| snowy_beach                      | 26.2                    |
| birch_forest                     | 232                     |
| birch_forest_hills               | 66.2                    |
| dark_forest                      | 233                     |
| snowy_taiga                      | 104                     |
| snowy_taiga_hills                | 23.7                    |
| giant_tree_taiga                 | 77.4                    |
| giant_tree_taiga_hills           | 34.7                    |
| wooded_mountains                 | 148                     |
| savanna                          | 263                     |
| savanna_plateau                  | 66.4                    |
| badlands                         | 41.3                    |
| wooded_badlands_plateau          | 22.4                    |
| badlands_plateau                 | 9.38                    |
| warm_ocean                       | 129                     |
| lukewarm_ocean                   | 345                     |
| cold_ocean                       | 338                     |
| deep_lukewarm_ocean              | 262                     |
| deep_cold_ocean                  | 262                     |
| deep_frozen_ocean                | 79.5                    |
| sunflower_plains                 | 57.4                    |
| desert_lakes                     | 17.8                    |
| gravelly_mountains               | 27.8                    |
| flower_forest                    | 45.4                    |
| taiga_mountains                  | 19.3                    |
| swamp_hills                      | 12.0                    |
| ice_spikes                       | 16.4                    |
| modified_jungle                  | 4.84                    |
| modified_jungle_edge             | 0.0312                  |
| tall_birch_forest                | 10.6                    |
| tall_birch_hills                 | 7.44                    |
| dark_forest_hills                | 11.4                    |
| snowy_taiga_mountains            | 4.52                    |
| giant_spruce_taiga               | 4.43                    |
| giant_spruce_taiga_hills         | 4.51                    |
| modified_gravelly_mountains      | 19.1                    |
| shattered_savanna                | 11.5                    |
| shattered_savanna_plateau        | 7.55                    |
| eroded_badlands                  | 2.82                    |
| modified_wooded_badlands_plateau | 1.16                    |
| modified_badlands_plateau        | 0.673                   |
| bamboo_jungle                    | 8.75                    |
| bamboo_jungle_hills              | 2.74                    |

#### 下界生物群系概率

[TODO]

#### 末地生物群系概率

[TODO]

### 名字对照表

#### 噪声

相比而言，我更赞同 yarn 的名字，因为被 yarn 冠以“八度”之名的噪声生成器，内部（underlying）都是对应的普通噪声生成器的数组，对这些噪声分形取样得到新的噪声。

|        |   mcp    |     yarn      |          |
| ------ | :------: | :-----------: | -------- |
| 改进的 | Improved |    Perlin     | 柏林     |
| 简单的 | Simplex  |    Simplex    | 简单     |
| 八度的 | Octaves  | OctavePerlin  | 八度柏林 |
| 柏林的 |  Perlin  | OctaveSimplex | 八度简单 |

## 后记

[TODO]

## 鸣谢 

### Previewers

- 3TUSK @1
- 纪华裕 @2


1. 仅主世界基本完成
2. 前半段大致完善

### Reviewers

[TODO]

## 参考

[TODO]

## 相关链接

[TODO]



